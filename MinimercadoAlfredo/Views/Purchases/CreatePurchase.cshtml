@model MinimercadoAlfredo.ViewModels.PurchaseVM
@{
    ViewBag.Title = "CreatePurchase";
}

<h2 class="text-center">Nueva Compra</h2>
<hr style="color:grey;border-color:grey" />

<h3 class="text-center">Datos Generales</h3>
<br />

<table class="table table-striped table-bordered">
    <thead>
        <tr class="text-center" style="color:white; background-color:#4d77a3">
            <th width="310px">
                Proveedor
            </th>
            <th width="200px">
                Fecha de Adquisición
            </th>
            <th>
                Comentarios
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
                <select class="js-example-basic-single" id="providername" style="font:small-caption; width: 250px; height: 25px;">
                    <option value="0">Seleccione un Proveedor</option>
                    @foreach (var item in ViewBag.Providers)
                    {
                        <option value="@item.IdProvider">@item.ProviderName</option>
                    }
                </select>
                <a href="" class="btn btn-success btn-sm"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></a>
            </td>
            <td>
                <input type="date" class="panel-info" id="purchasedate" placeholder="dd/mm/aaaa" />
                @*<span class="error">saledate required</span>*@
            </td>
            <td>
                <input type="text" id="purchasecomments" placeholder="Ingrese un comentario" />
            </td>
        </tr>
    </tbody>
</table>

<h3 class="text-center">Productos Adquiridos</h3>
<hr style="color:grey;border-color:grey" />

<table class="table table-striped table-bordered">
    <thead>
        <tr style="color:white; background-color:#4d77a3">
            <td width="440px">Producto</td>
            <td>Costo de Adquisición</td>
            <td>Cantidad Adquirida</td>
            <td>Importe total de Compra</td>
            <td></td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
                <select class="js-example-basic-single" id="linedescription" style="font:small-caption; width: 380px; height: 25px;">
                    <option value="">Seleccione un Producto</option>
                    @foreach (var item in ViewBag.Products)
                    {
                        <option value="@item.IdProduct">@item.ProductNumber - @item.ProductDescription</option>
                    }
                </select>                
                <a href="" class="btn btn-success btn-sm"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></a>
                <span class="error">Es necesario que ingrese un Producto</span>
            </td>
            <td>
                <input type="text" id="linecost"/>
                <span class="error">Ingrese Costo</span>
            </td>
            <td>
                <input type="text" id="linequantity"/>
                <span class="error1">Ingrese Cantidad</span>
                <span class="error2">Cantidad Inválida</span>
            </td>
            <td>
                <input type="text" id="linetotal"/>
                <span class="error">Ingrese Total</span>
            </td>
            <td>
                <input type="button" id="add" value="Agregar" class="btn btn-success btn-sm" style="bottom:auto" />
            </td>
        </tr>
    </tbody>
</table>

<table class="table table-striped table-bordered" >
    <div id="orderItems" class="table table-striped table-bordered"></div>
</table>

<table class="table">
    <tbody>
        <tr>
            <td>
                Importe Total de Compra
            </td>
            <td>

            </td>
        </tr>
    </tbody>
</table>

<div>
    <button type="button" id="submit" class="btn btn-success" value="Guardar Compra">Guardar Compra</button>
</div>


<link href="@Url.Content("~/Content/css/select2.min.css")" rel="stylesheet" />
@section scripts
{
    <script src="@Url.Content("~/Scripts/select2.js")"></script>
    <script>
            $(document).ready(function () {
                $(".js-example-basic-single").select2();
            });

            //ESTA SECCIÓN SIRVE PARA AUTOCOMPLETAR CAMPOS, REQUIERE UN METODO EN EL CONTROLADOR (AQUÍ LO NOMBRA COMO Getproductdata)
            //$(document).ready(function () {
            //    $("#linedescription").change(function () {
            //        var options = {};
            //        options.url = "/Purchases/Getproductdata";
            //        options.type = "GET";
            //        options.data = { "product": $("#linedescription").val() };
            //        options.dataType = "json";
            //        options.success = function (data) {
            //            document.getElementById("linecost").value = data.Cost;
            //        };
            //        $.ajax(options);
            //    })
            //});
            
            //CALCULO AUTOMATICO DEL TOTAL DE COMPRA
            $(document).ready(function () {
                $("#linequantity").change(function () {
                    var cost = parseFloat($("#linecost").val());
                    var quantity = parseFloat($("#linequantity").val());
                    var total = cost * quantity;
                    document.getElementById("linetotal").value = total;
                })
            });

            $("#linetotal").click(function () {
                var cost = parseFloat($('#linecost').val());
                var quantity = parseFloat($('#linequantity').val());
                var total = price * quantity;
                document.getElementById("linetotal").value = total;
            });

            //BOTÓN AGREGAR PRODUCTO Y VALIDACIONES
            $(document).ready(function () {
                var orderItems = [];
                //AQUÍ DEFINIMOS LA FUNCIÓN DEL BOTON AGREGAR PRODUCTO
                $("#add").click(function () {
                    //CONTROL DE LOS VALORES DE LA LINEA DE PRODUCTO
                    var isValidItem = true;

                    if ($("#linedescription").val().trim() == "") {
                        isValidItem = false;
                        $("#linedescription").siblings("span.error").css("visibility", "visible");
                    } else {
                        $("#linedescription").siblings("span.error").css("visibility", "hidden");
                    }

                    if ($("#linecost").val.trim() == "") {
                        isValidItem = false;
                        $("#linecost").siblings("span.error").css("visibility", "visible");
                    } else {
                        $("#linecost").siblings("span.error").css("visibility", "hidden");
                    }

                    if ($("#linequantity").val().trim() == "") {
                        isValidItem = false;
                        $("#linequantity").siblings("span.error1").css("visibility", "visible");
                    } else {
                        $("#linequantity").siblings("span.error1").css("visibility", "hidden");
                    }

                    if ($("#linequantity").val().trim() == "0") {
                        isValidItem = false;
                        $("#linequantity").siblings("span.error2").css("visibility", "visible");
                    } else {
                        $("#linequantity").siblings("span.error2").css("visibility", "hidden");
                    }

                    if ($("#linetotal").val().trim() == "") {
                        isValidItem = false;
                        $("#linetotal").siblings("span.error").css("visibility", "visible");
                    } else {
                        $("#linetotal").siblings("span.error").css("visibility", "hidden");
                    }

                    //AQUÍ SE AGREGAN LOS PRODUCTOS SI SON VÁLIDOS
                    if (isValidItem) {
                        orderItems.push({
                            LineDescription: $("#linedescription").val().trim(),
                            LineCost: $("#linecost").val().trim(),
                            LineQuantity: $("#linequantity").val().trim(),
                            LineTotal: $()
                        })
                    }
                });
            })

            
    </script>
}
